{% extends 'layout/app.html.twig' %}

{% block title %}
	{{ template.name }}
	- Legal Docs Generator
{% endblock %}
{% block page_title %}
	{{ template.name }}
{% endblock %}

{% block content %}
	{% for message in app.flashes('success') %}
		<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
			{{ message }}
		</div>
	{% endfor %}

	<div class="mb-6 flex gap-4">
		<a href="{{ path('app_template_index') }}" class="text-gray-600 hover:text-gray-900">
			← Retour aux templates
		</a>
	</div>

	<div
		class="grid grid-cols-1 lg:grid-cols-3 gap-6">
		<!-- Contenu principal -->
		<div class="lg:col-span-2 space-y-6">
			<div class="bg-white rounded-lg shadow p-6">
				<h3 class="text-lg font-semibold text-gray-900 mb-4">Aperçu du contenu</h3>
				<div class="prose max-w-none bg-gray-50 p-4 rounded border text-sm">
					<pre class="whitespace-pre-wrap font-mono">{{ template.bodyMarkdown }}</pre>
				</div>
			</div>
		</div>

		<!-- Sidebar infos -->
		<div class="space-y-6">
			<div class="bg-white rounded-lg shadow p-6">
				<h3 class="text-lg font-semibold text-gray-900 mb-4">Informations</h3>
				<dl class="space-y-3 text-sm">
					<div>
						<dt class="text-gray-500">Visibilité</dt>
						<dd class="font-medium">
							<span class="px-2 py-1 text-xs rounded-full {{ template.visibility == 'global' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800' }}">
								{{ template.visibility == 'global' ? 'Global' : 'Privé' }}
							</span>
						</dd>
					</div>
					<div>
						<dt class="text-gray-500">Version</dt>
						<dd class="font-medium">v{{ template.version }}</dd>
					</div>
					<div>
						<dt class="text-gray-500">Créé par</dt>
						<dd class="font-medium">{{ template.createdBy.name }}</dd>
					</div>
					<div>
						<dt class="text-gray-500">Créé le</dt>
						<dd class="font-medium">{{ template.createdAt|date('d/m/Y H:i') }}</dd>
					</div>
					{% if template.updatedAt %}
						<div>
							<dt class="text-gray-500">Modifié le</dt>
							<dd class="font-medium">{{ template.updatedAt|date('d/m/Y H:i') }}</dd>
						</div>
					{% endif %}
					{% if template.organization %}
						<div>
							<dt class="text-gray-500">Organisation</dt>
							<dd class="font-medium">{{ template.organization.name }}</dd>
						</div>
					{% endif %}
				</dl>
			</div>

			{% if template.variablesJson|length > 0 %}
				<div class="bg-white rounded-lg shadow p-6">
					<h3 class="text-lg font-semibold text-gray-900 mb-4">Variables ({{ template.variablesJson|length }})</h3>
					<ul class="space-y-2 text-sm">
						{% for variable in template.variablesJson %}
							<li class="flex items-center gap-2">
								<code class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs">{{ '{{' ~ variable.name ~ '}}' }}</code>
								<span class="text-gray-600">({{ variable.type }}
									{% if variable.required %}, requis
									{% endif %})</span>
							</li>
						{% endfor %}
					</ul>
				</div>
			{% endif %}

			<div class="bg-white rounded-lg shadow p-6 space-y-3">
				<a href="{{ path('app_document_new', {id: template.id}) }}" class="block w-full text-center bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition">
					Générer un document
				</a>

				{% if is_granted('edit', template) %}
					<a href="{{ path('app_template_edit', {id: template.id}) }}" class="block w-full text-center bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200 transition">
						Modifier
					</a>

					<form action="{{ path('app_template_delete', {id: template.id}) }}" method="post" onsubmit="return confirm('Supprimer ce template ?')">
						<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ template.id) }}">
						<button type="submit" class="w-full text-center bg-red-100 text-red-700 px-4 py-2 rounded-md hover:bg-red-200 transition cursor-pointer">
							Supprimer
						</button>
					</form>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
