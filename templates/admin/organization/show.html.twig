{% extends 'layout/app.html.twig' %}

{% block title %}{{ organization.name }}{% endblock %}
{% block page_title %}{{ organization.name }}{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{{ path('app_admin_organization_index') }}" class="text-gray-600 hover:text-gray-900">
        ← Retour aux organisations
    </a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">
        <!-- Membres -->
        <div class="bg-white rounded-lg shadow">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-900">Membres ({{ organization.users|length }})</h3>
                <a href="{{ path('app_admin_user_new') }}" class="text-sm text-indigo-600 hover:text-indigo-800">
                    + Ajouter
                </a>
            </div>
            
            {% if organization.users|length > 0 %}
            <div class="divide-y divide-gray-100">
                {% for user in organization.users %}
                <div class="p-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-indigo-600 font-medium">{{ user.name|slice(0,1)|upper }}</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">{{ user.name }}</p>
                            <p class="text-sm text-gray-500">{{ user.email }}</p>
                        </div>
                    </div>
                    <div>
                        {% set mainRole = user.roles|first %}
                        {% set roleLabels = {
                            'ROLE_ADMIN_ORG': 'Admin',
                            'ROLE_EDITOR': 'Éditeur',
                            'ROLE_VALIDATOR': 'Validateur',
                            'ROLE_USER': 'Utilisateur'
                        } %}
                        <span class="text-sm text-gray-600">{{ roleLabels[mainRole] ?? mainRole }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="p-6 text-center text-gray-500">
                Aucun membre dans cette organisation
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="space-y-6">
        <!-- Infos -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Informations</h3>
            <dl class="space-y-3 text-sm">
                <div>
                    <dt class="text-gray-500">Plan</dt>
                    <dd class="font-medium capitalize">{{ organization.settings.plan ?? 'free' }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500">Créé le</dt>
                    <dd class="font-medium">{{ organization.createdAt|date('d/m/Y') }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500">Membres</dt>
                    <dd class="font-medium">{{ organization.users|length }}</dd>
                </div>
                <div>
                    <dt class="text-gray-500">Templates</dt>
                    <dd class="font-medium">{{ organization.templates|length }}</dd>
                </div>
            </dl>
        </div>
        
        <!-- Actions -->
        <div class="bg-white rounded-lg shadow p-6 space-y-3">
            <a href="{{ path('app_admin_organization_edit', {id: organization.id}) }}" 
               class="block w-full text-center bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition">
                Modifier
            </a>
            
            {% if organization.users|length == 0 %}
            <form action="{{ path('app_admin_organization_delete', {id: organization.id}) }}" method="post" 
                  onsubmit="return confirm('Supprimer cette organisation ?')">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ organization.id) }}">
                <button type="submit" class="w-full text-center bg-red-100 text-red-700 px-4 py-2 rounded-md hover:bg-red-200 transition cursor-pointer">
                    Supprimer
                </button>
            </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}